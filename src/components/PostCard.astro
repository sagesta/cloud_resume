---
import type { CollectionEntry } from "astro:content";
import { Icon } from "astro-icon/components";
import I18nKey from "../i18n/i18nKey";
import { i18n } from "../i18n/translation";
import PostMetadata from "./PostMeta.astro";

interface Props {
	class?: string;
	entry: CollectionEntry<"posts">;
	title: string;
	url: string;
	published: Date;
	updated?: Date;
	tags: string[];
	category: string | null;
	image: string;
	description: string;
	draft: boolean;
	style: string;
}
const {
	entry,
	title,
	url,
	published,
	updated,
	tags,
	category,
	image,
	description,
} = Astro.props;

const hasCover = image !== undefined && image !== null && image !== "";

const coverWidth = "28%";

const { remarkPluginFrontmatter } = await entry.render();
---
<div class="flex flex-col md:flex-row gap-6 md:gap-8 w-full transition active:scale-[0.98] md:active:scale-100 hover:bg-[var(--card-bg-hover)] p-4 md:p-6 rounded-2xl group relative">
    <!-- Mobile: Entire card is clickable overlay -->
    <a href={url} aria-label={title} class="absolute inset-0 z-10 md:hidden active:scale-[0.98] transition-transform"></a>

    <div class="w-full md:w-[60%] flex flex-col justify-between relative z-20 pointer-events-none md:pointer-events-auto">
        <div class="transition">
            <a href={url}
               class="transition group w-full block font-bold mb-3 text-3xl text-90
            hover:text-[var(--primary)] dark:hover:text-[var(--primary)]
            active:text-[var(--title-active)] dark:active:text-[var(--title-active)]
            ">
                {title}
            </a>

            <!-- metadata -->
            <PostMetadata published={published} updated={updated} tags={tags} category={category} hideTagsForMobile={true} hideUpdateDate={true} class="mb-4"></PostMetadata>

            <!-- description -->
            <div class:list={["transition text-75 mb-3.5 pr-4", {"line-clamp-2 md:line-clamp-1": !description}]}>
                { description || remarkPluginFrontmatter.excerpt }
            </div>

            <!-- word count and read time  -->
            <div class="text-sm text-black/30 dark:text-white/30 flex gap-4 transition">
                <div>
                    {remarkPluginFrontmatter.words} {" " + i18n(remarkPluginFrontmatter.words === 1 ? I18nKey.wordCount : I18nKey.wordsCount)}
                </div>
                <div>|</div>
                <div>
                    {remarkPluginFrontmatter.minutes} {" " + i18n(remarkPluginFrontmatter.minutes === 1 ? I18nKey.minuteCount : I18nKey.minutesCount)}
                </div>
            </div>
        </div>

        <div class="hidden md:flex flex-row justify-end mt-4 text-black/30 dark:text-white/30 transition group-hover:text-black/70 dark:group-hover:text-white/70 group-hover:translate-x-1">
             <Icon name="material-symbols:chevron-right-rounded" class="text-4xl"></Icon>
        </div>
    </div>

    {hasCover && <div class="w-full md:w-[40%] rounded-xl overflow-hidden relative z-20 group-hover:shadow-lg transition mt-4 md:mt-0">
        <div class="transition h-full w-full absolute bg-black/10 dark:bg-black/20 pointer-events-none md:group-hover:bg-transparent"></div>
        <img src={image} alt="Project Cover" class="w-full h-full object-cover aspect-video md:aspect-auto">
    </div>}
</div>
<div class="mx-6 md:mx-8 border-b border-black/5 dark:border-white/5 last:border-none"></div>

<style define:vars={{coverWidth}}>
</style>
